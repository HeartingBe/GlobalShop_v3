GlobalShop 全球商店数据包测试指导

---

测试主要从两个方面考虑：

1. 测试所有功能可用性；
2. 测试限制条件；

---

## 操作

**内容**

1. 使用左键来选择、触发选项，进行查询和购买等操作；
2. 部分页面有左键确认逻辑，第一次左键查看物品信息，第二次左键确认操作；
3. 使用右键来返回到上一个菜单；
4. 几乎所有的操作都会有音效反馈；
5. 查看某个选项或某个物品时，会有信息框显示物品的信息；
6. 部分操作会使玩家获得物品，需要检查当玩家周围也有玩家时，能不能被其它玩家捡起（代码上有 uuid 限制，理论上只能被操作的玩家捡起，测试时可以保持背包为满，然后获得物品，此时物品会掉在地上，观察能否被别的玩家捡起）

**限制**

1. 使用右键返回上一个菜单时，会对准入口处；
2. 主菜单不能返回上一个菜单；
3. 按 shift 脱离商店，关闭商店；
4. 商店的处理周期是 10t，所以狂点鼠标没用，每秒最多响应两次；

---

## 打开商店

**内容**

1. 任何玩家输入 /trigger open_global_shop set 1，或者用 1 根木棍合成 1 根木棍，可以打开商店

**限制**

1. 已经打开商店时，无法再打开商店；
2. 没有允许的维度不能打开商店，默认原版 3 个维度可以打开，如果需要添加维度，需要在源代码的谓词 json 文件中配置；
3. 被管理员禁用商店的玩家无法打开商店，管理员设置界面可以禁用玩家使用商店；管理员被禁用仍然可以打开商店
4. 周围 10 格内有别人在使用商店，无法打开商店；
5. 周围有非法方块，无法打开商店（例如在地狱传送门、末地传送门附近）；
6. 商店有注册人数限制，当使用过商店的人数超过 1000 人后，第 1001 位玩家首次打开商店时会提示失败；

---

## 主菜单

**内容**

1. 进入各个子页面；
2. 输出包信息，可点击访问项目地址和作者网站；

---

## 玩家商店主菜单

从主菜单进入

**内容**

1. 上架物品，使用 inputter_1 触发器设置价格触发。
   1. 必须先点击“上架物品”按钮，才能上架物品，否则即使设置 inputter_1 分数也会被阻止；
   2. 物品价格需为正数；
   3. 物品价格不能太大；
   4. 每位玩家上架的物品和退回的物品数量总和有最大限制（默认 54），例如上架 54 个物品后，再上架就会被阻止；
   5. 货币不能上架；
   6. 空手不能上架；

2. 查看自己的金钱；

3. 领取收入；

   收入的来源仅有一个，即玩家通过玩家商店和其他玩家达成交易时获取。通过回收商店获取的收入是实时到账的，并不需要在此处领取；

   1. 玩家拥有的钱太多，就无法领取收入（防止整数溢出）；

4. 进入各个子页面；

---

## 玩家商店

从玩家商店主菜单进入，此页面可旋转，浏览来自所有玩家上架的物品

**内容**

1. 显示最新，每次都从最新上架的物品开始显示。物品 id 递增，但因为是从最新的开始显示，浏览时越往后物品 id 越小，属正常现象；且浏览玩家商店和浏览自己正在出售的物品都会显示剩余时间，时间到物品会被退还；
2. 移动准心查看不同的物品，如果看向的物品不存在（例如被购买，或者超时被退回，会刷新显示）；
3. 点击一次，在聊天栏输出物品信息，鼠标移动到字上面会显示原版的物品框；
4. 点击两次，进行购买
   1. 如果是自己卖出的物品，直接退回（到背包中）；
   2. 别人卖出的物品，执行购买逻辑；
      1. 买的时候，有别的玩家也购买了这个物品（但先于自己），显示购买失败，并刷新显示；
5. 输入 trigger glbs_inputter_1 set ? 跳转到序号为 ? 的物品开始显示；
6. 输入 trigger glbs_inputter_2 set ? 跳转到 id 为 ? 的物品开始显示；（跳转序号和跳转 id 的功能仅玩家商店有，其它模式没有）

**限制**

1. 购买物品时，钱不够提示购买失败；
2. 跳转序号或 id 时，不输入正数提示失败；
3. 跳转序号或 id 时，已经看向跳转后的结果，提示失败；
4. 跳转序号时，输入的序号超过玩家商店物品最大数，提示失败；
5. 跳转 id 时，找不到此 id 的物品，提示失败；
6. 极短时间内同时输入 glbs_inputter_1、glbs_inputter_2 请求跳转序号和 id，只会处理跳转序号；

---

## 浏览自己出售的物品

从玩家商店主菜单进入

出售商店的逻辑和玩家商店一致，但展示的物品都是自己出售的物品，该页面的基本作用是玩家可以查看自己卖了哪些物品，并且可以取回

---

## 出售商店

从主菜单进入

出售商店的逻辑和玩家商店基本一致，但有以下区别：

1. 出售商店的物品可被玩家无限次购买，不会过期，只能由管理员添加和移除；
2. 购买时只扣除玩家金钱，并不会有人获利（管理员只是配置出售商店，并不盈利）；

---

## 回收商店

从主菜单进入

回收商店的逻辑和玩家商店基本一致，但回收商店是玩家用物品换取金钱

**内容**

1. 只会回收背包 4 排物品，其它栏位（例如副手栏位、4 个盔甲栏位的物品，不会回收）；
2. 回收时，检查的是总数量，例如回收 64 个泥土，也不需要把 64 个泥土凑在一起，只要背包 4 排的泥土加起来不少于 64 个即可；
3. nbt 严格对应，例如商店只回收普通钻石剑，那么带附魔的不能回收，有耐久损失的也不能回收；

**限制**

1. 玩家的钱太多，就无法回收，因为要防止整数溢出；

---

## 历史购买、历史出售

从玩家商店主界面进入

**内容**

1. 玩家商店每一次成功购买记录都会写入买家的历史购买和卖家的历史出售；
2. 点击历史记录会在聊天栏输出物品信息，鼠标移动到字上面会显示原版的物品框；

**限制**

1. 出售商店和回收商店的操作不会记录，仅有玩家商店成功购买时会被记录；
2. 历史购买记录有存储上限，每位玩家默认存储 27 个，达到上限时，再进行购买会记录最新的记录，并丢弃最旧的记录；
3. 历史出售记录有存储上限，同上；

---

## 领取退回物品

从玩家商店主界面进入

**内容**

1. 目前仅有“超时下架”一种理由会导致物品从玩家商店被退回，在此界面可以取回。之所以设置退回机制，是因为商店处理超时物品时，玩家可能不在线，所以物品会被存储到此处，等待玩家领取；

**限制**

1. 退回的物品有存储上限，具体是：每位玩家退回的物品和玩家商店中上架的物品数量之和不超过一定数量（默认 54 个），这一点可见测试章节 **玩家商店主菜单-1-4**；

---

## 个人设置

从主菜单进入

目前仅支持玩家更改展示框的大小和位置

**更改展示框的大小和位置**

1. 更改有上限，不管是改小还是改大，都有最大值，超过最大值会警告；
2. 不管是更改还是重置，都是实时更新状态，不需要重新进入商店；

---

## 编辑模式主菜单

从主菜单进入

管理员配置出售商店和回收商店，以及进行商店全局设置，都在该菜单

**向出售商店、回收商店添加物品**

1. 必须先点击对应按钮，才能添加物品；
2. 价格需为正数；
3. 价格不能太大；
4. 货币不能添加到出售商店或回收商店；
5. 空手不能添加；

**从出售商店、回收商店移除物品**

1. 从编辑模式主菜单进入；
2. 有二次确认机制；

**修改货币兑换**

1. 从编辑模式主菜单进入；
2. 必须先点击对应货币，然后点击下方三个选项才进行对应操作；
3. 某个货币被禁用时，无法进行任何操作，除非先解除禁用；
4. 设置货币的外观物品时，其自定义名称、 Lores 和附魔都会被记录。如果没有自定义名称，则会采用默认自定义名称“全球商店货币”；如果没有附魔，则会写入一个不存在的附魔 id 产生附魔光效，但玩家的准心停在货币上时，信息框不会显示附魔信息；
5. 不能拿着货币来设置货币的外观物品；
6. 修改货币面值时，输入必须是正数，且不能太大；
7. 最上方的按钮是重置所有货币；

**管理员设置**

1. 输入自定义记分板、语言、玩家名字时，不能包含空格；
2. 输入自定义记分板、语言时，会检查存在性和可用性；
3. 清空动态数据需要检查是不是真的清空；

**卸载**

1. 需要检查数据有没有抹除干净；

---

## 存钱、取钱

从主菜单进入

1. 货币被禁用时不能取这个货币；
2. 钱不够不能取；
3. 最右边是存钱按钮，只会存主手的货币，会按照存的数量添加相应金钱到用户金钱记分板上；
4. 主手不是货币不能存钱；
