Copyright © Mini_Ye All rights reserved.

---

## GlobalShop 项目地址
https://github.com/HeartingBe/GlobalShop_v3.git

## 作者主页or联系方式

### Mini_Ye

https://space.bilibili.com/133430292

可以直接给我发私信^_^

1579526201@qq.com

### Alumopper

https://alumopper.top/

## 版权声明和使用规定
1. 允许修改和发布修改后的版本，但需要保留代码中关于原作者（`Mini_Ye` 和 `Alumopper`）和项目的所有原始信息；
2. 禁止对原版本和修改后的版本采取任何形式的收费行为；
3. 源代码和脚本生成的映射后的数据包都需要保留原 `README.md` 文件，请勿修改脚本阻止改文件的复制；
4. 原作者不承担任何游戏存档因运行本项目导致的一切问题；
5. 本数据包的多语言文本是为了方便玩家使用（不需要安装额外资源包），可能出现翻译不准确的情况，但绝不会包含对任何对象的不尊重或歧视。（如果有请告诉作者，将修正相关表述以解除误会）
6. 最终解释权归原作者 Mini_Ye 和 Alumopper 所有。

## 使用方法
<font color=#FF0050 size=3>不要将本项目的源代码直接放入游戏存档运行</font>

**<font color=orange size=4>如果你没有修改源代码，只是为了获取作者提供的版本，在 release 发布的正式版本中你将看到 `GlobalShop_v?.?.?.zip` 的文件，下载它，然后放入游戏存档的 `datapacks` 文件夹，执行 `/reload` 命令即可。</font>**

### 1. 如何选择本数据包的版本？
请查看 [version_records.md](version_records.md)，里面记录了本数据包的所有版本和对应的生效 minecraft 版本；

本数据包的版本号初始为 `v3.0.1`，其中 `v3.0` 是大版本号。只有当 minecraft 推出新版本后，作者才会推出新的大版本号来适配新的 minecraft 版本。最后的 `1` 是小版本号，仅供修复错误使用。

例如，本数据包的 `v3.0.1` 和 `v3.0.8` 的生效 minecraft 版本是相同的，因为它们都以 `v3.0` 为开头，但后者修复了一些错误，你应该选择后者而不是前者。

<font color=red>请注意</font>，升级你的存档时，本数据包的旧数据不可用。转换数据格式的成本过高，请原谅作者无力维护升级存档功能。例如，你在 `JE 1.20.4` 版本的存档中使用了本数据包的 `v3.0` 版本，当你将存档升级为 `JE 1.20.6` 时，虽然本数据包的 `v3.1` 版本适配 `JE 1.20.6` 版本的存档，但是你不能直接更换数据包压缩文件来试图升级，因为数据格式不相同。

<font color=lightgreen>正确的做法是</font>，在存档升级之前，进入世界，在商店的控制面板中按照步骤卸载商店，清空所有的数据（必要时应该提醒玩家取回物品），然后删除数据包的 `v3.0` 版本，之后升级你的存档。在新版本的存档中，再放入数据包的 `v3.1` 版本。

### 2. 我修改了源代码，如何生成可运行的数据包？
生成数据包的脚本做了以下工作：
1. 映射函数文件。因为函数路径太长会导致在游戏中玩家在聊天栏输入 `/function` 命令时弹出的候选函数路径显示框过大且有显示错误。脚本只映射 `global_shop` 命名空间，但不会映射 `functions/test` 文件夹和 `functions/settings` 文件夹。不映射其他命名空间的文件，脚本会直接复制其他命名空间的文件。被映射的函数会重命名为 `mapper/?.mcfunction`，其中 `?` 是数字；
2. 映射的函数文件会去掉注释，去掉前导空格，去掉空行；

请按照以下步骤生成数据包：
1. 运行 `mapper/gen_mapped_datapack.py`，在 `mapper` 文件夹中会新增 `GlobalShop_v3.?.?` 文件夹
2. 进入 `mapper/GlobalShop_v3.?.?` 文件夹，将里面所有内容压缩为压缩包 `GlobalShop_v3.?.?.zip`
3. 将压缩包放入游戏存档的 `datapacks` 文件夹后，进入游戏执行 `/reload` 命令。

请注意，在压缩时不要包含 `mapper/GlobalShop_v3` 文件夹，否则游戏无法识别到数据包。换句话说，你应该选择所有 `mapper/GlobalShop_v3` 文件夹中的子文件和子文件夹进行压缩。

### 3. 如何添加一种新的语言？
感谢你为本数据包添加新的翻译文本，请你将翻译好的文本提交给作者，作者审查后会合并到代码中。审查是为了防止出现有攻击性、歧视性等可能导致不良影响的翻译。

你的名字会被写入翻译函数文件的翻译者中。

请查看项目 github 地址，确保你想要翻译的语言还没有翻译完成。

请按照以下步骤翻译：
1. 打开 `translation` 文件夹，你将看到 `new_language.xlsx` 文件，它是一个翻译模板，里面包含英文版本和中文版本，你需要参考文本内容进行翻译；
2. 将 `new_language.xlsx` 复制一份到同目录下的 `languages` 文件夹中。进入 `languages` 文件夹，将复制的翻译模板文件改名为新的语言的缩写（例如翻译为英文，则改名为 `en_us.xlsx`）。
3. 打开重命名后的翻译模板，你将看到 3 个工作表，分别是 `author_info`、`translation` 和 `common`；
4. `author_info` 工作表需要你填入作者名字和联系方式，联系方式可不写；
5. `translation` 工作表的 `B` 列，即 `translate key` 列，存在一些以 `g_lang` 为开头的翻译键。如果它是棕色的，说明它可以引用自一个通用翻译键，你不需要翻译它；如果它是黑色的，那么你需要翻译它，请在 `H` 列，即 `new_language` 列书写翻译文本。你可以参照英文文本(`F` 列)和中文文本(`G` 列)进行翻译。我还在 `D` 列和 `E` 列为你提供了一些截图，方便你理解正在被翻译的文本在游戏中显示的位置；
6. `common` 工作表存储的是通用翻译键，我为了帮助你节省翻译的工作量，将具有相同表述的文本合并为通用翻译键。请在 `E` 列，即 `new_language` 列书写翻译文本。你可以参照英文文本(`C` 列)和中文文本(`D` 列)进行翻译；
7. 当你翻译完这两个工作表，请与我取得联系，我会尽快将你的努力应用到项目的最新版本^_^

请注意：
1. 译文中不要有单引号或双引号，否则可能导致拼接的命令有语法错误；
2. 你无需担心译文之后是一个数字时需要在末尾添加空格，因为我在代码中已经添加了空格，所以所有译文的末尾都不需要空格。

如果你的译文是给自己使用的，请自己生成语言函数文件。方法：
1. 按以上要求翻译好，然后将 `<xxx>.xlsx` 放入项目的 `translation/languages` 文件夹下；
2. 运行项目的 `translation/gen_translation_mcf.py`，输入 `xxx`
3. 现在你应该可以在 `translation` 目录下看到名为 `xxx` 的文件夹，里面有 `init.mcfunction`；
4. 进入项目的 `data/global_shop/functions/text` 文件夹，将上个步骤生成的 `xxx` 文件夹放到这里，就像 `zh_cn` 和 `en_us` 文件夹那样；
5. 你已成功添加自己的语言，请在游戏中按方法启用它；

## Q&A
### 我添加了全球商店，也执行了 `/reload`，为什么打开不了商店，也没有输出提示信息？
全球商店首次加载后，需要管理员启动运行，但一些信息只会向管理员发送。如果你拥有服务器的管理员权限，你需要执行 `/function global_shop:settings/get_permission` 来成为全球商店的管理员。
成为全球商店的管理员后，再次执行 `/reload`，你就能看到全球商店发送的信息了，请根据提示启动商店运行。

### 我剥夺了一位服务器管理员的管理员权限，但是他依旧是商店的管理员，要如何去除某位玩家的商店管理员权限？
执行 `/scoreboard players operation <玩家名> glbs_permission = Permission::PLAYER glbs_common` 来去除某位玩家的商店管理员权限。

### 首次使用全球商店的语言是英文的，如何改成自己想要的语言？
全球商店内置了 `en_us` 和 `zh_cn` 两种语言，默认使用 `en_us`。要更改语言，请从主界面进入控制面板，然后进入更多设置，点击修改语言选项，按照提示修改语言。

### 为什么存钱、回收物品和领取收入时，金钱太多会提示操作失败？
这三种操作都会使玩家的金钱增加。记分板在计算机中使用 int 类型存储，最大值为 2147483647。如果两个 int 的值相加后大于这个最大值，它会变成负数，即整数回绕。例如483647 + 1 = -2147483648。所以为了保护玩家的钱，当玩家持有的金钱太多时就不允许进行金钱增加的操作。

### 为什么我尝试上架物品，但是提示我“商店的物品数量达到上限”？
因为每位玩家 **售货架上的物品数量 + 退还的物品数量** 是有限的，默认是 54。这是为了防止有玩家向商店塞入大量物品。
你需要先下架或取回一些退还的物品，再上架。